{"job":{"components":{"12654":{"id":12654,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":624,"y":-240,"width":32,"height":32,"inputConnectorIDs":[12663],"outputConnectorIDs":[12666],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Insert"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SCD_FLAG"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"N"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SCD_FLAG"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"C"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"OR"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12655":{"id":12655,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":128,"y":-240,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[12665],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_ODS_PHONE_CALL"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT\n\tDEAL_ID,\n\tENGAGEMENT_ID,\n\tCALL_STARTED_TIMESTAMP,\n\tENGAGEMENT_TYPE,\n\tCALL_TYPE,\n\tSALES_REP_NAME,\n\tTITLE,\n\tPHONE_NUMBER,\n\tCALL_DURATION_MS,\n\tSALES_REP_OUTBOUND_TITLE,\n\tSALES_REP_INBOUND_TITLE,\n\tMETADATA_FROMNUMBER_FIXED,\n\tMETADATA_TONUMBER_FIXED,\n\tCALL_DURATION_MINUTES,\n\tCALL_NUM\nFROM\n\tBPF_ODS.\"PUBLIC\".VW_SRC_ODS_PHONE_CALLS\n\n\n\n\n/*with phone_calls_raw as ( \n          select \n          distinct\n          ea.value as deal_id,\n          engagement__id as engagement_id,\n          --convert_timezone('US/Pacific',e.engagement__timestamp) as call_started_timestamp,\n          convert_timezone('America/New_York','America/Los_Angeles',e.engagement__timestamp::timestamp_ntz) AS call_started_timestamp,\n          case when e.engagement__type = 'CALL' then 'Call' else e.engagement__type end as engagement_type,\n          e.metadata__durationmilliseconds as call_duration_ms,\n          call_duration_ms/60.0/1000.0 as call_duration_minutes,\n          replace(trim(e.metadata__fromnumber,'+'),'-','') as metadata_fromnumber_fixed,\n          --e.metadata__fromnumber,\n          pn.phone_number as from_phone_number,\n          pn.caller AS sales_rep_outbound,\n          pn.title as sales_rep_outbound_title,\n          replace(trim(e.metadata__tonumber,'+'),'-','') as metadata_tonumber_fixed,\n          --e.metadata__tonumber,\n          pn2.phone_number as to_phone_number,\n          pn2.caller as sales_rep_inbound,\n          pn2.title as sales_rep_inbound_title\nfrom \n--hubspot_data_export.engagements e\nBPF_LANDING.\"PUBLIC\".HUBSPOT_DATA_EXPORT_ENGAGEMENTS e\n   LEFT JOIN \n   --hubspot_data_export.engagements__associations__dealids ea\n   BPF_LANDING.\"PUBLIC\".HUBSPOT_DATA_EXPORT_ENGAGEMENTS_ASSOCIATIONS_DEALIDS ea\n     ON ea._sdc_source_key_engagement_id = e.engagement__id\n   LEFT JOIN \n   --facts.phone_numbers pn\n   BPF_LANDING.\"PUBLIC\".FACTS_PHONE_NUMBERS pn\n   ON replace(trim(e.metadata__fromnumber,'+'),'-','') = pn.phone_number\n    --ON (e.metadata__fromnumber = pn.phone_number\n     --  OR e.metadata__fromnumber = concat('+',pn.phone_number))  \n   LEFT JOIN \n   --facts.phone_numbers pn2\n   BPF_LANDING.\"PUBLIC\".FACTS_PHONE_NUMBERS pn2\n    ON replace(trim(e.metadata__tonumber,'+'),'-','') = pn2.phone_number\n   --ON (e.metadata__tonumber = pn2.phone_number\n      -- OR e.metadata__tonumber = concat('+',pn2.phone_number))  \nwhere engagement__type = 'CALL'\nand value is not NULL\n),\n\n\n\nphone_calls as (\nselect \ndeal_id,\nengagement_id,\ncall_started_timestamp,\nengagement_type,\n'Outbound' as call_type,\nsales_rep_outbound as sales_rep_name,\nsales_rep_outbound_title as title,\nfrom_phone_number as phone_number,\ncall_duration_ms,\nsales_rep_outbound_title,\nsales_rep_inbound_title,\nmetadata_fromnumber_fixed,\nmetadata_tonumber_fixed,\ncall_duration_minutes\nfrom phone_calls_raw\nwhere sales_rep_outbound is not null\n\nunion all\n\nselect \ndeal_id,\nengagement_id,\ncall_started_timestamp,\nengagement_type,\n'Inbound' as call_type,\nsales_rep_inbound as sales_rep_name,\nsales_rep_inbound_title as title,\nto_phone_number as phone_number,\ncall_duration_ms,\nsales_rep_outbound_title,\nsales_rep_inbound_title,\nmetadata_fromnumber_fixed,\nmetadata_tonumber_fixed,\ncall_duration_minutes\nfrom phone_calls_raw\nwhere sales_rep_inbound is not null\n)\n\nselect\npc.*,\nrow_number() over (partition by deal_id order by call_started_timestamp asc) as call_num\nfrom phone_calls pc*/"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12656":{"id":12656,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":128170095,"x":304,"y":-128,"width":32,"height":32,"inputConnectorIDs":[12661],"outputConnectorIDs":[12664],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"REN_TGT_DIM_PRD"}}}},"visible":true},"2":{"slot":2,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DEAL_ID"},"2":{"slot":2,"type":"STRING","value":"DEAL_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"ENGAGEMENT_ID"},"2":{"slot":2,"type":"STRING","value":"ENGAGEMENT_ID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"CALL_STARTED_TIMESTAMP"},"2":{"slot":2,"type":"STRING","value":"CALL_STARTED_TIMESTAMP"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"ENGAGEMENT_TYPE"},"2":{"slot":2,"type":"STRING","value":"ENGAGEMENT_TYPE"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"CALL_TYPE"},"2":{"slot":2,"type":"STRING","value":"CALL_TYPE"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"SALES_REP_NAME"},"2":{"slot":2,"type":"STRING","value":"SALES_REP_NAME"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"PHONE_NUMBER"},"2":{"slot":2,"type":"STRING","value":"PHONE_NUMBER"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"CALL_DURATION_MS"},"2":{"slot":2,"type":"STRING","value":"CALL_DURATION_MS"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"CALL_DURATION_MINUTES"},"2":{"slot":2,"type":"STRING","value":"CALL_DURATION_MINUTES"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"TITLE"},"2":{"slot":2,"type":"STRING","value":"TITLE"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"CALL_NUM"},"2":{"slot":2,"type":"STRING","value":"CALL_NUM"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12657":{"id":12657,"inputCardinality":"TWO","outputCardinality":"MANY","implementationID":-359894709,"x":304,"y":-240,"width":32,"height":32,"inputConnectorIDs":[12664,12665],"outputConnectorIDs":[12662],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SCD-1"}}}},"visible":true},"2":{"slot":2,"name":"Master Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"REN_TGT_DIM_PRD"}}}},"visible":true},"3":{"slot":3,"name":"Match Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DEAL_ID"}}}},"visible":true},"4":{"slot":4,"name":"Compare Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DEAL_ID"}}}},"visible":true},"5":{"slot":5,"name":"Output Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"master_DEAL_ID"},"2":{"slot":2,"type":"STRING","value":"TGT_DEAL_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"compare_DEAL_ID"},"2":{"slot":2,"type":"STRING","value":"SRC_DEAL_ID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"compare_ENGAGEMENT_ID"},"2":{"slot":2,"type":"STRING","value":"SRC_ENGAGEMENT_ID"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"compare_CALL_STARTED_TIMESTAMP"},"2":{"slot":2,"type":"STRING","value":"SRC_CALL_STARTED_TIMESTAMP"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"compare_ENGAGEMENT_TYPE"},"2":{"slot":2,"type":"STRING","value":"SRC_ENGAGEMENT_TYPE"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"compare_CALL_DURATION_MS"},"2":{"slot":2,"type":"STRING","value":"SRC_CALL_DURATION_MS"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"compare_CALL_DURATION_MINUTES"},"2":{"slot":2,"type":"STRING","value":"SRC_CALL_DURATION_MINUTES"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"compare_METADATA_FROMNUMBER_FIXED"},"2":{"slot":2,"type":"STRING","value":"SRC_METADATA_FROMNUMBER_FIXED"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"compare_METADATA_TONUMBER_FIXED"},"2":{"slot":2,"type":"STRING","value":"SRC_METADATA_TONUMBER_FIXED"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"compare_SALES_REP_OUTBOUND_TITLE"},"2":{"slot":2,"type":"STRING","value":"SRC_SALES_REP_OUTBOUND_TITLE"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"compare_SALES_REP_INBOUND_TITLE"},"2":{"slot":2,"type":"STRING","value":"SRC_SALES_REP_INBOUND_TITLE"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"compare_PHONE_NUMBER"},"2":{"slot":2,"type":"STRING","value":"SRC_PHONE_NUMBER"}}}},"visible":true},"6":{"slot":6,"name":"Indicator Column","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SCD_FLAG"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12658":{"id":12658,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":128,"y":-128,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[12661],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_DIM_PHONE_CALLS"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ODS_PHONE_CALLS"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DEAL_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"ENGAGEMENT_ID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"CALL_STARTED_TIMESTAMP"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"ENGAGEMENT_TYPE"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"CALL_TYPE"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"SALES_REP_NAME"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"PHONE_NUMBER"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"CALL_DURATION_MS"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"CALL_DURATION_MINUTES"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"TITLE"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"CALL_NUM"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PUBLIC"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BPF_ODS"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12659":{"id":12659,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":480,"y":-240,"width":32,"height":32,"inputConnectorIDs":[12662],"outputConnectorIDs":[12663],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"E_DIM_PHN_CALL_PRD"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TO_TIMESTAMP_NTZ(CURRENT_TIMESTAMP(9))"},"2":{"slot":2,"type":"STRING","value":"C_INSERT_UPD_DATE"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12660":{"id":12660,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":832,"y":-240,"width":32,"height":32,"inputConnectorIDs":[12666],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TGT_ODS_PHONE_CALL"}}}},"visible":true},"200":{"slot":200,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ODS_PHONE_CALLS"}}}},"visible":true},"201":{"slot":201,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PUBLIC"}}}},"visible":true},"202":{"slot":202,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BPF_ODS"}}}},"visible":true},"203":{"slot":203,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BPF_SMALL"}}}},"visible":true},"204":{"slot":204,"name":"Target Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"target"}}}},"visible":true},"205":{"slot":205,"name":"Source Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"input"}}}},"visible":true},"206":{"slot":206,"name":"Join Expression","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"target\".\"DEAL_ID\"=\"input\".\"DEAL_ID\""},"2":{"slot":2,"type":"STRING","value":"Join"}}}},"visible":true},"207":{"slot":207,"name":"When Matched","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"target\".\"DEAL_ID\"=\"input\".\"DEAL_ID\""},"2":{"slot":2,"type":"STRING","value":"Update"}}}},"visible":true},"208":{"slot":208,"name":"Update Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"C_INSERT_UPD_DATE"},"2":{"slot":2,"type":"STRING","value":"PHONE_NUMBER"}}}},"visible":true},"209":{"slot":209,"name":"Include Not Matched","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"210":{"slot":210,"name":"Insert Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DEAL_ID"},"2":{"slot":2,"type":"STRING","value":"DEAL_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_ENGAGEMENT_ID"},"2":{"slot":2,"type":"STRING","value":"ENGAGEMENT_ID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_CALL_STARTED_TIMESTAMP"},"2":{"slot":2,"type":"STRING","value":"CALL_STARTED_TIMESTAMP"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_PHONE_NUMBER"},"2":{"slot":2,"type":"STRING","value":"PHONE_NUMBER"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_CALL_DURATION_MS"},"2":{"slot":2,"type":"STRING","value":"CALL_DURATION_MS"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_CALL_DURATION_MINUTES"},"2":{"slot":2,"type":"STRING","value":"CALL_DURATION_MINUTES"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_SALES_REP_OUTBOUND_TITLE"},"2":{"slot":2,"type":"STRING","value":"SALES_REP_OUTBOUND_TITLE"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_SALES_REP_INBOUND_TITLE"},"2":{"slot":2,"type":"STRING","value":"SALES_REP_INBOUND_TITLE"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_METADATA_FROMNUMBER_FIXED"},"2":{"slot":2,"type":"STRING","value":"METADATA_FROMNUMBER_FIXED"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_METADATA_TONUMBER_FIXED"},"2":{"slot":2,"type":"STRING","value":"METADATA_TONUMBER_FIXED"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"12661":{"id":12661,"sourceID":12658,"targetID":12656},"12662":{"id":12662,"sourceID":12657,"targetID":12659},"12663":{"id":12663,"sourceID":12659,"targetID":12654},"12664":{"id":12664,"sourceID":12656,"targetID":12657},"12665":{"id":12665,"sourceID":12655,"targetID":12657},"12666":{"id":12666,"sourceID":12654,"targetID":12660}},"notes":{"12653":{"id":12653,"x":36,"y":-275,"width":893,"height":196,"text":"ODS_PHONE_CALLS","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"BPF_CUSTFNL_ODS_PHONE_CALLS","description":"","type":"TRANSFORMATION","tag":"3e87c482-a9ca-41c8-9ce2-449097f74409"}}