{"job":{"components":{"12767":{"id":12767,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":160,"y":16,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[12770],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SQL 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT\n\tPLATFORM,\n\tCAMPAIGN_ID,\n\tAD_ID,\n\tAD_NAME,\n\tREGION,\n\tFOREST_STATUS,\n\tFOREST_REGION,\n\tCAMPAIGN,\n\tPURPOSE,\n\tTACTIC,\n\tADS_DATE,\n\tSPEND,\n\tIMPRESSIONS,\n\tCLICKS\nFROM\n\tBPF_ODS.\"PUBLIC\".VW_SRC_ADS\n\n\n/*with google_campaign_reports as (\nselect \nto_char(\"_SDC_REPORT_DATETIME\", 'YYYY-MM-DD HH24:MI:SS') as \"_SDC_REPORT_DATETIME\",\nmin(\"day\")::date as min_day,\nmax(\"day\")::date as max_day\nfrom \n--google_adwords.campaign_performance_report\nBPF_LANDING.\"PUBLIC\".GOOGLE_ADWORDS_CAMPAIGN_PERFORMANCE_REPORT\ngroup by 1\n)\n--SELECT max(SDC_REPORT_DATETIME) FROM google_campaign_reports\n,\n\ngoogle_campaign_report_dates as (\nselect \nC.FULLDATE AS DAY,\nmax(\"_SDC_REPORT_DATETIME\") as report_datetime\nfrom \n--{{ @Calendar as c }}\nBPF_DATAMART.\"PUBLIC\".DIM_CALENDAR C\nleft outer join \ngoogle_campaign_reports camp \non C.FULLDATE between camp.min_day and camp.max_day\nwhere C.FULLDATE between '2017-12-01' and getdate()\ngroup by 1\norder by 1,2\n)\n--SELECT * FROM google_campaign_report_dates \n,\n\ngoogle_display as (\nselect \ncast('Google Display' as text) as platform,\ncast('Live' as text) as forest_status,\ncast('California' as text) as forest_region,\ncampaign,\ncamp.BASECAMPAIGNID AS Campaign_ID, -- New added 18-May\n'-1' AS AD_ID, -- New added 18-May\n'-1' AS AD_NAME, -- New added 18-May\nDAY AS ads_date,\ncost/1000000.0 as spend,\nimpressions,\nclicks\nfrom \n--google_adwords.campaign_performance_report camp\nBPF_LANDING.\"PUBLIC\".GOOGLE_ADWORDS_CAMPAIGN_PERFORMANCE_REPORT camp\ninner join \ngoogle_campaign_report_dates dates \non camp.\"day\" = dates.DAY and to_char(camp.\"_SDC_REPORT_DATETIME\", 'YYYY-MM-DD HH24:MI:SS') = dates.report_datetime\nwhere clientname = 'Better Place Forests - GDN' -- Added 18-May\n)\n--SELECT * FROM google_display\n,\n\ngoogle_search_reports as (\nselect \nto_char(\"_SDC_REPORT_DATETIME\", 'YYYY-MM-DD HH24:MI:SS') as \"_SDC_REPORT_DATETIME\",\nmin(\"day\") as min_day,\nmax(\"day\") as max_day\nfrom \n--google_adwords.search_query_performance_report\nBPF_LANDING.\"PUBLIC\".GOOGLE_ADWORDS_SEARCH_QUERY_PERFORMANCE_REPORT\ngroup by 1\n)\n--SELECT * FROM google_search_reports\n,\n\ngoogle_search_report_dates as (\nselect \nC.FULLDATE as DAY,\nmax(\"_SDC_REPORT_DATETIME\") as report_datetime\nfrom \n--{{ @Calendar as c }}\nBPF_DATAMART.\"PUBLIC\".DIM_CALENDAR C\nleft outer join \ngoogle_search_reports camp on c.FULLDATE  between camp.min_day and camp.max_day\nwhere C.FULLDATE between '2017-12-01' and getdate()\ngroup by 1\n)\n--SELECT * FROM google_search_report_dates\n,\n\ngoogle_search as (\nselect \ncast('Google SEM' as text) as platform,\ncast('Live' as text) as forest_status,\ncast('California' as text) as forest_region,\ncampaign ,\nCAMPAIGNID AS Campaign_ID, -- New added 18-May\n'-1' AS AD_ID,\n'-1' AS AD_NAME,\ncamp.\"day\" AS ads_date,\ncost/1000000.0 as spend,\nimpressions,\nclicks\nfrom \n--google_adwords.search_query_performance_report camp\nBPF_LANDING.\"PUBLIC\".GOOGLE_ADWORDS_SEARCH_QUERY_PERFORMANCE_REPORT camp\ninner join \ngoogle_search_report_dates dates \non camp.\"day\" = dates.DAY and to_char(camp.\"_SDC_REPORT_DATETIME\", 'YYYY-MM-DD HH24:MI:SS') = dates.report_datetime\nwhere clientname = 'Better Place Forests - SEM'\n)\n--SELECT * FROM google_search\n,\n\ngoogle_ads as (\nselect *\nfrom google_display\n\nunion all \n\nselect * \nfrom google_search\nwhere ads_date >= '2020-01-01'\n)\n--SELECT * FROM google_ads\n,\n\nfacebook_ads as (\nSELECT \ncast('Facebook' as text) as platform,\ncase\nwhen forest_live_sales_date is null and ad_location is not null then cast('Pre-Sales' as text)\nwhen forest_live_sales_date is null and ad_location is null then cast('Live' as text)\nwhen forest_live_sales_date > date_start then cast('Pre-Sales' as text)\nelse cast('Live' as text) end as forest_status,\ncase when ad_location is null then cast('California' as text) else ad_location end as forest_region,\ncampaign_name as campaign,\nad.CAMPAIGN_ID AS Campaign_ID, -- New added 18-May\nAD_ID AS AD_ID,  -- New added 18-May\nAD_NAME AS AD_NAME, -- New added 18-May\ndate_start AS ads_date,\nspend,\nimpressions as impressions,\nclicks as clicks\nFROM \n--bpf_facebook_ads.ads_insights ad\nBPF_LANDING.\"PUBLIC\".BPF_FACEBOOK_ADS_ADS_INSIGHTS ad\nLEFT OUTER JOIN \n--facts.fb_regional_campaign_ids as r \nBPF_LANDING.\"PUBLIC\".FACTS_FB_REGIONAL_CAMPAIGN_IDS r ON\n  (CASE WHEN r.adset_id is null then ad.campaign_id = r.campaign_id\n  when r.adset_id is not null then ad.campaign_id = r.campaign_id and ad.adset_id = r.adset_id\n  else null end)\n)\n--SELECT * FROM facebook_ads\n,\n\ntaboola_ads as (\nselect \ncast('Taboola' as text) as platform,\ncast('Live' as text) as forest_status,\ncast('California' as text) as forest_region,\ncamp.\"name\" as campaign,\nperf.\"campaign_id\" AS Campaign_ID,\n'-1'  AS AD_ID,\n'-1' AS AD_NAME,\ncast(\"date\" as date) as ads_date,\nperf.\"spent\" as spend,\n\"impressions\" AS impressions,\n\"clicks\" AS clicks\nfrom \n--bpf_taboola.campaign_performance perf\nBPF_LANDING.\"PUBLIC\".BPF_TABOOLA_CAMPAIGN_PERFORMANCE perf\nleft outer join \n--bpf_taboola.campaigns camp \nBPF_LANDING.\"PUBLIC\".BPF_TABOOLA_CAMPAIGNS camp\non camp.\"id\" = perf.\"campaign_id\"\n)\n--SELECT * FROM taboola_ads\n,\n\nmisc_ads as (\nSELECT\nplatform as platform,\ncast('Live' as text) as forest_status,\ncast('California' as text) as forest_region,\ncampaign_name as campaign,\nuniform(4, 9999999, random()) AS Campaign_ID,\n'-1'  AS AD_ID,\n'-1' AS AD_NAME,\nads_date,\ncost as spend,\nimpressions,\nclicks\nFROM \n--facts.ads_misc\nBPF_LANDING.\"PUBLIC\".FACTS_ADS_MISC\norder by ads_date\n),\n\nbing_campaign_reports as (\nselect \nto_char(\"_sdc_report_datetime\", 'YYYY-MM-DD HH24:MI:SS') as \"_SDC_REPORT_DATETIME\",\nmin(\"timeperiod\") as min_day,\nmax(\"timeperiod\") as max_day\nfrom \n--bpf_bing_ads.campaign_performance_report\nBPF_LANDING.\"PUBLIC\".BPF_BING_ADS_CAMPAIGN_PERFORMANCE_REPORT\ngroup by 1\n),\n\nbing_campaign_report_dates as (\nselect \nc.FULLDATE as DAY,\nmax(\"_SDC_REPORT_DATETIME\") as report_datetime\nfrom \nBPF_DATAMART.\"PUBLIC\".DIM_CALENDAR C\n--{{ @Calendar as c }}\nleft outer join \nbing_campaign_reports camp \non C.FULLDATE between camp.min_day and camp.max_day\nwhere C.FULLDATE between '2017-12-01' and getdate()\ngroup by 1\norder by 1,2\n)\n--SELECT * FROM bing_campaign_report_dates\n,\n\nbing_ads as (\nselect \ncast('Bing' as text) as platform,\ncast('Live' as text) as forest_status,\ncast('California' as text) as forest_region,\n\"campaignname\" as campaign,\nuniform(4, 9999999, random()) Campaign_ID,\n'-1'  AS AD_ID,\n'-1' AS AD_NAME,\ncamp.\"timeperiod\" AS ads_date,\n\"spend\" AS spend,\n\"impressions\" AS impressions,\n\"clicks\" AS clicks\nfrom \n--bpf_bing_ads.campaign_performance_report camp\nBPF_LANDING.\"PUBLIC\".BPF_BING_ADS_CAMPAIGN_PERFORMANCE_REPORT camp\ninner join bing_campaign_report_dates dates on camp.\"timeperiod\" = dates.DAY \nand to_char(camp.\"_sdc_report_datetime\", 'YYYY-MM-DD HH24:MI:SS') = dates.report_datetime\n)\n--SELECT * FROM bing_ads\n,\n\nads_combined as (\nselect \nplatform,\nforest_status,\nforest_region,\ncampaign,\nCampaign_ID,\nAD_ID,\nAD_NAME,\nads_date,\nspend,\nimpressions,\nclicks\nfrom google_ads\n\nunion all \n\nselect \nplatform,\nforest_status,\nforest_region,\ncampaign,\nCampaign_ID,\nAD_ID,\nAD_NAME,\nads_date,\nspend,\nimpressions,\nclicks\nfrom facebook_ads\n\nunion all \n\nselect \nplatform,\nforest_status,\nforest_region,\ncampaign,\nCampaign_ID,\nAD_ID,\nAD_NAME,\nads_date,\nspend,\nimpressions,\nclicks\nfrom taboola_ads\n\nunion all \n\nselect \nplatform,\nforest_status,\nforest_region,\ncampaign,\nCampaign_ID,\nAD_ID,\nAD_NAME,\nads_date,\nspend,\nimpressions,\nclicks\nfrom misc_ads\n\nunion all \n\nselect \nplatform,\nforest_status,\nforest_region,\ncampaign,\nCampaign_ID,\nAD_ID,\nAD_NAME,\nads_date,\nspend,\nimpressions,\nclicks\nfrom bing_ads\n)\n\nselect \nplatform,\nCampaign_ID,\nAD_ID,\nAD_NAME,\ncase when position('5' , campaign,1) > 0 and position('_6' , campaign,1) > 0 then substring(campaign, position('5' , campaign,1) + 1, position('_6' , campaign,1) - 2) else null end as region,\nforest_status,\ncoalesce(case when region = 'NorCal' then 'California' else region end,forest_region) as forest_region,\ncast(campaign as varchar(5000)) AS campaign ,\ncase when position('_6' , campaign,1) > 0 and position('_7' , campaign,1) > 0 then substring(campaign, position('_6' , campaign,1) + 2, position('_7' , campaign,1) - position('_6' , campaign,1) - 2) else null end as purpose,\ncase when position('_8' , campaign,1) > 0 then left(substring(campaign, position('_8' , campaign,1) + 2, len(campaign) - len(position('_8' , campaign,1))), position('_' , substring(campaign, position('_8' , campaign,1) + 2, len(campaign) - len(position('_8' IN campaign))),1)-1) else null end as tactic,\nads_date,\nspend,\nimpressions,\nclicks\nfrom ads_combined\n--WHERE Campaign_ID ='-1'\norder by ads_date DESC*/"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12768":{"id":12768,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":288,"y":16,"width":32,"height":32,"inputConnectorIDs":[12770],"outputConnectorIDs":[12771],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"E_ODS_ADS"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CURRENT_TIMESTAMP(9)"},"2":{"slot":2,"type":"STRING","value":"C_INS_UPD_DT"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12769":{"id":12769,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":211954775,"x":416,"y":16,"width":32,"height":32,"inputConnectorIDs":[12771],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ODS_ADS"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ODS_ADS"}}}},"visible":true},"4":{"slot":4,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PLATFORM"},"2":{"slot":2,"type":"STRING","value":"PLATFORM"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"REGION"},"2":{"slot":2,"type":"STRING","value":"REGION"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"FOREST_STATUS"},"2":{"slot":2,"type":"STRING","value":"FOREST_STATUS"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"FOREST_REGION"},"2":{"slot":2,"type":"STRING","value":"FOREST_REGION"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"CAMPAIGN"},"2":{"slot":2,"type":"STRING","value":"CAMPAIGN"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"TACTIC"},"2":{"slot":2,"type":"STRING","value":"TACTIC"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"ADS_DATE"},"2":{"slot":2,"type":"STRING","value":"ADS_DATE"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"SPEND"},"2":{"slot":2,"type":"STRING","value":"SPEND"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"IMPRESSIONS"},"2":{"slot":2,"type":"STRING","value":"IMPRESSIONS"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"CLICKS"},"2":{"slot":2,"type":"STRING","value":"CLICKS"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"PURPOSE"},"2":{"slot":2,"type":"STRING","value":"PURPOSE"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"C_INS_UPD_DT"},"2":{"slot":2,"type":"STRING","value":"INSERT_DT"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"CAMPAIGN_ID"},"2":{"slot":2,"type":"STRING","value":"CAMPAIGN_ID"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"AD_ID"},"2":{"slot":2,"type":"STRING","value":"AD_ID"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"AD_NAME"},"2":{"slot":2,"type":"STRING","value":"AD_NAME"}}}},"visible":true},"5":{"slot":5,"name":"Truncate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Truncate"}}}},"visible":true},"200":{"slot":200,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PUBLIC"}}}},"visible":true},"201":{"slot":201,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BPF_ODS"}}}},"visible":true},"202":{"slot":202,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BPF_SMALL"}}}},"visible":true},"203":{"slot":203,"name":"Fix Data Type Mismatches","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"12770":{"id":12770,"sourceID":12767,"targetID":12768},"12771":{"id":12771,"sourceID":12768,"targetID":12769}},"notes":{},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"BPF_CUSTFNL_ODS_ADS","description":null,"type":"TRANSFORMATION","tag":"65a252c7-08a0-4ded-9186-f53ea3491ea2"}}