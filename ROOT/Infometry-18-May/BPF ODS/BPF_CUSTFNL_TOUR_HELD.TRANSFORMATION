{"job":{"components":{"12774":{"id":12774,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":304,"y":160,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[18142],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"REF_ODS_TOUR_HELD"}}}},"visible":true},"2":{"slot":2,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ODS_TOUR_HELD"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DEAL_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"EMAIL"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"FOREST"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"CHANNEL"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"TREE_ID"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"CHECKED_IN_AT"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"CHECKED_OUT_AT"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"TOUR_STEWARD"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"VISIT_NUM"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PUBLIC"}}}},"visible":true},"6":{"slot":6,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BPF_ODS"}}}},"visible":true},"7":{"slot":7,"name":"Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12775":{"id":12775,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":305,"y":65,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[12780],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_ODS_TOUR_HELD"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT\n\tDEAL_ID,\n\tEMAIL,\n\tFOREST,\n\tCHANNEL,\n\tTREE_ID,\n\tCHECKED_IN_AT,\n\tCHECKED_OUT_AT,\n\tTOUR_STEWARD,\n\tVISIT_NUM\nFROM\n\tBPF_ODS.\"PUBLIC\".VW_SRC_ODS_TOUR_HELD\n    WHERE TRIM(DEAL_ID) IS NOT nULL\n\n/*\nwith visits_combined as (\n  select\n  v.hubspot_deal_id as deal_id,\n  v.email,\n  f.name as forest, \n  channel,\n  convert_timezone('US/Pacific',v.checked_in_at) as checked_in_at,\n  convert_timezone('US/Pacific',v.checked_out_at) as checked_out_at,\n  v.lead_steward as tour_steward,\n  v.SELECTED_TREE_ID AS TREE_ID\nFROM \n--online_contracts_trees_database.visits v\nBPF_LANDING.\"PUBLIC\".ONLINE_CONTRACTS_TREES_DATABASE_VISITS V\njoin \n--online_contracts_trees_database.forests f\n BPF_LANDING.\"PUBLIC\".ONLINE_CONTRACTS_TREES_DATABASE_FORESTS f\nON\n  v.forest_id = f.id\n)--SELECT * FROM visits_combined\n,\nvisits as (\nselect \ndeal_id,\nemail,\nforest,\nchannel,\nTREE_ID,\ncoalesce(checked_in_at, checked_out_at) as checked_in_at,\nchecked_out_at,\ntour_steward,\nrow_number() over (partition by deal_id order by coalesce(checked_in_at, checked_out_at) asc) as visit_num\nfrom visits_combined\n)\n\nselect * from visits where visit_num =1\n\n*/"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12776":{"id":12776,"inputCardinality":"TWO","outputCardinality":"MANY","implementationID":-359894709,"x":455,"y":66,"width":32,"height":32,"inputConnectorIDs":[12780,18142],"outputConnectorIDs":[12784],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SCD-2"}}}},"visible":true},"2":{"slot":2,"name":"Master Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"REF_ODS_TOUR_HELD"}}}},"visible":true},"3":{"slot":3,"name":"Match Keys","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DEAL_ID"}}}},"visible":true},"4":{"slot":4,"name":"Compare Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"EMAIL"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"FOREST"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"CHANNEL"}}}},"visible":true},"5":{"slot":5,"name":"Output Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"master_DEAL_ID"},"2":{"slot":2,"type":"STRING","value":"TGT_DEAL_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"compare_DEAL_ID"},"2":{"slot":2,"type":"STRING","value":"SRC_DEAL_ID"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"compare_EMAIL"},"2":{"slot":2,"type":"STRING","value":"SRC_EMAIL"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"compare_FOREST"},"2":{"slot":2,"type":"STRING","value":"SRC_FOREST"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"compare_CHANNEL"},"2":{"slot":2,"type":"STRING","value":"SRC_CHANNEL"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"compare_TREE_ID"},"2":{"slot":2,"type":"STRING","value":"SRC_TREE_ID"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"compare_CHECKED_IN_AT"},"2":{"slot":2,"type":"STRING","value":"SRC_CHECKED_IN_AT"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"compare_CHECKED_OUT_AT"},"2":{"slot":2,"type":"STRING","value":"SRC_CHECKED_OUT_AT"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"compare_TOUR_STEWARD"},"2":{"slot":2,"type":"STRING","value":"SRC_TOUR_STEWARD"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"compare_VISIT_NUM"},"2":{"slot":2,"type":"STRING","value":"SRC_VISIT_NUM"}}}},"visible":true},"6":{"slot":6,"name":"Indicator Column","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SCD-FLAG"}}}},"visible":true},"7":{"slot":7,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12777":{"id":12777,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":583,"y":66,"width":32,"height":32,"inputConnectorIDs":[12784],"outputConnectorIDs":[12781],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"E_ODS_TOUR_HELD"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"CURRENT_TIMESTAMP(9)"},"2":{"slot":2,"type":"STRING","value":"C_INS_UPD_DT"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"IFF(LEN(\"SRC_EMAIL\") > 100,'NA',\"SRC_EMAIL\")"},"2":{"slot":2,"type":"STRING","value":"C_EMAIL"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12778":{"id":12778,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":711,"y":66,"width":32,"height":32,"inputConnectorIDs":[12781],"outputConnectorIDs":[12783],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"F_INS_UPD"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SCD-FLAG"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"N"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SCD-FLAG"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"C"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"OR"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"12779":{"id":12779,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":-1848704949,"x":823,"y":66,"width":32,"height":32,"inputConnectorIDs":[12783],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TGT_ODS_TOUR_HELD"}}}},"visible":true},"200":{"slot":200,"name":"Target Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ODS_TOUR_HELD"}}}},"visible":true},"201":{"slot":201,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"PUBLIC"}}}},"visible":true},"202":{"slot":202,"name":"Database","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BPF_ODS"}}}},"visible":true},"203":{"slot":203,"name":"Warehouse","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BPF_SMALL"}}}},"visible":true},"204":{"slot":204,"name":"Target Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TGT"}}}},"visible":true},"205":{"slot":205,"name":"Source Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SRC"}}}},"visible":true},"206":{"slot":206,"name":"Join Expression","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"TGT\".\"DEAL_ID\"=\"SRC\".\"DEAL_ID\""},"2":{"slot":2,"type":"STRING","value":"Join"}}}},"visible":true},"207":{"slot":207,"name":"When Matched","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"TGT\".\"DEAL_ID\"=\"SRC\".\"DEAL_ID\""},"2":{"slot":2,"type":"STRING","value":"Update"}}}},"visible":true},"208":{"slot":208,"name":"Update Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_EMAIL"},"2":{"slot":2,"type":"STRING","value":"EMAIL"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_FOREST"},"2":{"slot":2,"type":"STRING","value":"FOREST"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_CHANNEL"},"2":{"slot":2,"type":"STRING","value":"CHANNEL"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_TREE_ID"},"2":{"slot":2,"type":"STRING","value":"TREE_ID"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_CHECKED_IN_AT"},"2":{"slot":2,"type":"STRING","value":"CHECKED_IN_AT"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_CHECKED_OUT_AT"},"2":{"slot":2,"type":"STRING","value":"CHECKED_OUT_AT"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_TOUR_STEWARD"},"2":{"slot":2,"type":"STRING","value":"TOUR_STEWARD"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_VISIT_NUM"},"2":{"slot":2,"type":"STRING","value":"VISIT_NUM"}}}},"visible":true},"209":{"slot":209,"name":"Include Not Matched","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"210":{"slot":210,"name":"Insert Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_DEAL_ID"},"2":{"slot":2,"type":"STRING","value":"DEAL_ID"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"C_EMAIL"},"2":{"slot":2,"type":"STRING","value":"EMAIL"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_FOREST"},"2":{"slot":2,"type":"STRING","value":"FOREST"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_CHANNEL"},"2":{"slot":2,"type":"STRING","value":"CHANNEL"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_TREE_ID"},"2":{"slot":2,"type":"STRING","value":"TREE_ID"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_CHECKED_IN_AT"},"2":{"slot":2,"type":"STRING","value":"CHECKED_IN_AT"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_CHECKED_OUT_AT"},"2":{"slot":2,"type":"STRING","value":"CHECKED_OUT_AT"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_TOUR_STEWARD"},"2":{"slot":2,"type":"STRING","value":"TOUR_STEWARD"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"SRC_VISIT_NUM"},"2":{"slot":2,"type":"STRING","value":"VISIT_NUM"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"12780":{"id":12780,"sourceID":12775,"targetID":12776},"12781":{"id":12781,"sourceID":12777,"targetID":12778},"12783":{"id":12783,"sourceID":12778,"targetID":12779},"12784":{"id":12784,"sourceID":12776,"targetID":12777},"18142":{"id":18142,"sourceID":12774,"targetID":12776}},"notes":{"12773":{"id":12773,"x":234,"y":28,"width":655,"height":176,"text":"ODS TOUR HELD","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"BPF_CUSTFNL_TOUR_HELD","description":null,"type":"TRANSFORMATION","tag":"f5852b09-55ee-430b-9d25-0ccb319516e3"}}