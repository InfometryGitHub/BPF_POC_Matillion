{"job":{"components":{"44825":{"id":44825,"inputCardinality":"ZERO","outputCardinality":"MANY","connectorHint":"UNCONDITIONAL","executionHint":"FLOW","implementationID":444132438,"x":-720,"y":-208,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[44830],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Start 0"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"44826":{"id":44826,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"ITERATE","implementationID":1025742816,"x":-432,"y":-240,"width":32,"height":16,"inputConnectorIDs":[44829],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Loop Iterator 0"}}}},"visible":true},"2":{"slot":2,"name":"Variable to Iterate","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Iterate_Value"}}}},"visible":true},"3":{"slot":3,"name":"Starting Value","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${RowNbrMin}"}}}},"visible":true},"4":{"slot":4,"name":"Increment Value","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":"1"}}}},"visible":true},"5":{"slot":5,"name":"End Value","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"${RowNbrMax}"}}}},"visible":true},"6":{"slot":6,"name":"Break on Failure","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"7":{"slot":7,"name":"Concurrency","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sequential"}}}},"visible":true},"999":{"slot":999,"name":"Record Values In Task History","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[44863],"inputIterationConnectorIDs":[]},"44827":{"id":44827,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"EXECUTE","implementationID":-1032749985,"x":-592,"y":-256,"width":32,"height":32,"inputConnectorIDs":[44830],"outputSuccessConnectorIDs":[44829],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Query Result To Scalar 0"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"SELECT MIN(ROW_NBR)MIN_DEAL_NBR, MAX(ROW_NBR)MAX_DEAL_NBR FROM (\nSELECT \nTREE_KEY,\n SALE_PERSON_KEY,\nCUST_KEY,\n FOREST_KEY,\n TGT_LEAD_KEY,\n\tSRC_LEAD_ID::varchar as SRC_LEAD_ID,\n\tTGT_LEAD_ID,\n\tTGT_DEAL_ID,\n\tTGT_CONTRACT_ID,\n\tSRC_CONTACT_EMAIL,\n\tSRC_CUSTOMER_FIRST_NAME,\n\tSRC_CUSTOMER_LAST_NAME,\n\tSRC_CONTACT_NAME,\n\tSRC_FINAL_LEAD_SCORE_TIER::varchar AS SRC_FINAL_LEAD_SCORE_TIER,\n\tSRC_DEAL_PIPELINE::varchar(500) SRC_DEAL_PIPELINE,\n\tSRC_DEAL_ID::varchar as SRC_DEAL_ID,\n\tTGT_LEAD_SCORE,\n\tSRC_DEAL_CREATED_DT,\n\tSRC_PREFERRED_FOREST,\n\tSRC_REGIONAL_DEPOSIT_FOREST ,\n\tSRC_DEAL_FOREST,    \n\tSRC_TOUR_SCHEDULED_FOREST::varchar(500)AS SRC_TOUR_SCHEDULED_FOREST,\n\tSRC_TOUR_HELD_FOREST,\n\tSRC_TOUR_HELD_FOREST_STEWARD,\n\tSRC_TOUR_HELD_CHANNEL,\n\tSRC_CONTRACT_STATUS,\n\tSRC_CONTRACT_REASON,\n    SRC_CONTRACT_ID::varchar(500) SRC_CONTRACT_ID,\n\tSRC_CONTRACT_FOREST,\n\tSRC_CONTRACT_CHANNEL AS SRC_CONTRACT_CHANNEL,\n\tSRC_CONTRACT_VALUE::varchar(500) AS SRC_CONTRACT_VALUE,\n\tSRC_ARBOR_TAG_ID,\n\tSRC_LEAD_STAGE,\n\tSRC_DEAL_CLOSED_TIMESTAMP,\n\tSRC_SALES_REP_NAME,\n\tSRC_SALES_REP_EMAIL,\n\tSRC_SDR_NAME,\n    SRC_SALES_REP_ID,\n\tSRC_PROJECTED_DEAL_AMOUNT::varchar AS SRC_PROJECTED_DEAL_AMOUNT,\n\tSRC_TOUR_SCHEDULED_CHANNEL,\n\t--TOUR_CHANNEL,\n\tSRC_DEPOSIT_TYPE,\n\tSRC_PITCH_SCHEDULE_TYPE,\n\t--FOREST,\n\tSRC_TREE_ID::varchar AS SRC_TREE_ID ,\n\tSRC_CONTACT_CREATED_dt,\n\tCASE WHEN YEAR(SRC_sales_lead_mql_timestamp) = '9999'  THEN NULL ELSE SRC_sales_lead_mql_timestamp END AS SRC_sales_lead_mql_timestamp,\n\tCASE WHEN YEAR(SRC_pitch_scheduled_dt) = '9999' THEN NULL ELSE SRC_pitch_scheduled_dt END AS SRC_pitch_scheduled_dt,\n\tSRC_SQL_TIMESTAMP,\n\tCASE WHEN YEAR(SRC_pitch_held_dt) = '9999' THEN NULL ELSE SRC_pitch_held_dt END AS SRC_pitch_held_dt,\n\tSRC_DEPOSIT_TIMESTAMP,\n    CASE WHEN YEAR(SRC_tour_scheduled_dt) = '9999' THEN NULL ELSE SRC_tour_scheduled_dt END AS SRC_tour_scheduled_dt,\n    CASE WHEN YEAR(SRC_tour_held_dt) = '9999' THEN NULL ELSE SRC_tour_held_dt END AS SRC_tour_held_dt,\n\tSRC_CONTRACT_SIGNED_Dt,\n    NULL UPDATE_DATE,\n    1 AS IS_LATEST,\n    ROW_NUMBER () OVER (PARTITION BY SRC_LEAD_ID ORDER BY SRC_DEAL_ID )ROW_NBR,\n    STATUS\n FROM \n(\nSELECT \nTGT.LEAD_KEY AS TGT_LEAD_KEY,\nTGT.LEAD_ID AS TGT_LEAD_ID,\nSRC.CUSTOMER_ID AS SRC_LEAD_ID,\nTGT.LEAD_DEAL_ID AS TGT_DEAL_ID,\nSRC.DEAL_ID AS SRC_DEAL_ID,\nTGT.LEAD_CONTRACT_ID AS TGT_CONTRACT_ID,\nSRC.CONTRACT_ID AS SRC_CONTRACT_ID,\nSRC.FINAL_LEAD_SCORE_TIER AS SRC_LEAD_STAGE,\nTGT.LEAD_SCORE AS TGT_LEAD_SCORE,\nSRC.DEAL_STAGE AS SRC_DEAL_STAGE,\nTGT.LEAD_STAGE AS TGT_LEAD_STAGE,\n--  Added May 20 2020\nCASE   WHEN SRC_LEAD_ID = TGT_LEAD_ID AND TGT_DEAL_ID IS NULL THEN 'UDND' \nWHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID IS NOT NULL AND SRC_CONTRACT_ID IS NULL AND  TGT_DEAL_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'UD' --\n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'UD'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID!=TGT_DEAL_ID AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n       \n       WHEN SRC_LEAD_ID IS NOT NULL AND SRC_DEAL_ID IS NOT NULL AND TGT_LEAD_ID IS NULL AND TGT_DEAL_ID IS NULL AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID =TGT_DEAL_ID AND SRC_CONTRACT_ID IS NOT NULL AND TGT_CONTRACT_ID IS NULL THEN 'UC'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID = TGT_CONTRACT_ID THEN 'UC'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID != TGT_CONTRACT_ID THEN 'I'\n       \n       WHEN SRC_LEAD_ID IS NOT NULL AND SRC_DEAL_ID IS NOT NULL AND SRC_CONTRACT_ID IS NOT NULL AND TGT_LEAD_ID IS NULL AND TGT_DEAL_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n        \n       ELSE 'NA'\nEND STATUS,\nSRC.CONTACT_EMAIL AS SRC_CONTACT_EMAIL,\nSRC.CUSTOMER_FIRST_NAME AS SRC_CUSTOMER_FIRST_NAME,\nSRC.CUSTOMER_LAST_NAME AS SRC_CUSTOMER_LAST_NAME,\nSRC.CONTACT_NAME AS SRC_CONTACT_NAME,\nSRC.FINAL_LEAD_SCORE_TIER AS SRC_FINAL_LEAD_SCORE_TIER,\nSRC.DEAL_PIPELINE AS SRC_DEAL_PIPELINE,\nSRC.PREFERRED_FOREST AS SRC_PREFERRED_FOREST,\nSRC.REGIONAL_DEPOSIT_FOREST AS SRC_REGIONAL_DEPOSIT_FOREST,\nSRC.DEAL_FOREST AS SRC_DEAL_FOREST,\nSRC.TOUR_SCHEDULED_FOREST AS SRC_TOUR_SCHEDULED_FOREST,\nSRC.CONTRACT_FOREST AS SRC_CONTRACT_FOREST,\nSRC.CONTRACT_VALUE AS SRC_CONTRACT_VALUE,\nSRC.CONTRACT_CHANNEL AS SRC_CONTRACT_CHANNEL,\nSRC.ARBOR_TAG_ID AS SRC_ARBOR_TAG_ID,\n--SRC.DEAL_STAGE AS SRC_DEAL_STAGE,\nSRC.DEAL_CREATED_DT AS SRC_DEAL_CREATED_DT,\nSRC.CONTRACT_STATUS AS SRC_CONTRACT_STATUS,\nSRC.CONTRACT_REASON AS SRC_CONTRACT_REASON,\nSRC.DEAL_CLOSED_TIMESTAMP AS SRC_DEAL_CLOSED_TIMESTAMP,\nSRC.SALES_REP_NAME AS SRC_SALES_REP_NAME,\nSRC.SALES_REP_EMAIL AS SRC_SALES_REP_EMAIL,\nSRC.SDR_NAME AS SRC_SDR_NAME,\nSRC.SALES_REP_ID AS SRC_SALES_REP_ID,\nSRC.PROJECTED_DEAL_AMOUNT AS SRC_PROJECTED_DEAL_AMOUNT,\nSRC.TOUR_SCHEDULED_CHANNEL AS SRC_TOUR_SCHEDULED_CHANNEL,\nSRC.DEPOSIT_TYPE AS SRC_DEPOSIT_TYPE,\nSRC.PITCH_SCHEDULE_TYPE AS SRC_PITCH_SCHEDULE_TYPE,\nSRC.TOUR_HELD_FOREST AS SRC_TOUR_HELD_FOREST,\nSRC.TREE_ID AS SRC_TREE_ID,\nSRC.TOUR_HELD_FOREST_STEWARD AS SRC_TOUR_HELD_FOREST_STEWARD,\nSRC.TOUR_HELD_CHANNEL AS SRC_TOUR_HELD_CHANNEL,\nSRC.CONTACT_CREATED_DT AS SRC_CONTACT_CREATED_DT,\n--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ADDED ON MAY.20 2020\n\t'9999-01-01' AS MAX_DT,\n\t'9999-12-31 13:30:00' AS COMP_DT,\t\n\tIFNULL(SRC.SALES_LEAD_MQL_TIMESTAMP,TO_TIMESTAMP_NTZ(MAX_DT)) SALES_LEAD_MQL_TIMESTAMP1,\n\tIFNULL(SRC.PITCH_SCHEDULED_DT,TO_TIMESTAMP_NTZ(MAX_DT)) PITCH_SCHEDULED1,\n\tIFNULL(SRC.PITCH_HELD_DT,TO_TIMESTAMP_NTZ(MAX_DT)) PITCH_HELD1,\n\tIFNULL(SRC.TOUR_SCHEDULED_DT,TO_TIMESTAMP_NTZ(MAX_DT))TOUR_SCHEDULED1,\n\tIFNULL(SRC.TOUR_HELD_DT,TO_TIMESTAMP_NTZ(MAX_DT)) TOUR_HELD1 ,\n\tIFNULL(SRC.CONTRACT_SIGNED_DT,TO_TIMESTAMP_NTZ(MAX_DT)) CONTRACT_SIGNED1,\n--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ \t   \n   \t\t  \n    --SRC.SALES_LEAD_MQL_TIMESTAMP AS SRC_SALES_LEAD_MQL_TIMESTAMP,\n\tLEAST(SALES_LEAD_MQL_TIMESTAMP1,PITCH_SCHEDULED1, PITCH_HELD1,TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_SALES_LEAD_MQL_TIMESTAMP,\n\t\n\t--SRC.PITCH_SCHEDULED_DT AS SRC_PITCH_SCHEDULED_DT,\n\tLEAST(PITCH_SCHEDULED1, PITCH_HELD1, TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_PITCH_SCHEDULED_DT,\n\t\n\tSRC.SQL_TIMESTAMP AS SRC_SQL_TIMESTAMP,\n\t\n\t--SRC.PITCH_HELD_DT AS SRC_PITCH_HELD_DT,\n    LEAST(PITCH_HELD1,TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_PITCH_HELD_DT,\n    \t\n\tSRC.DEPOSIT_TIMESTAMP AS SRC_DEPOSIT_TIMESTAMP,\n\t\n\t--SRC.TOUR_SCHEDULED_DT AS SRC_TOUR_SCHEDULED_DT,\n\tLEAST(TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1)AS  SRC_TOUR_SCHEDULED_DT,\n\t\n\t--SRC.TOUR_HELD_DT AS SRC_TOUR_HELD_DT,\n\tLEAST(TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_TOUR_HELD_DT,\n\t\n\tSRC.CONTRACT_SIGNED_DT AS SRC_CONTRACT_SIGNED_DT,\n\n\tSRC.INSERT_DATE AS SRC_INSERT_DATE,\n\tSRC.UPDATE_DATE AS SRC_UPDATE_DATE\nFROM BPF_ODS.\"PUBLIC\".VW_SRC_ODS_LEAD SRC\nINNER JOIN \"BPF_DATAMART\".\"PUBLIC\".\"FACT_LEAD\" TGT \nON (SRC.CUSTOMER_ID = TGT.LEAD_ID) AND (SRC.DEAL_ID  = TGT.LEAD_DEAL_ID) AND (SRC.CONTRACT_ID = TGT.LEAD_CONTRACT_ID)\nUNION ALL\n-- CUST_ID = TGT_DEAL_ID AND \nSELECT \nTGT.LEAD_KEY AS TGT_LEAD_KEY,\nTGT.LEAD_ID AS TGT_LEAD_ID,\nSRC.CUSTOMER_ID AS SRC_LEAD_ID,\nTGT.LEAD_DEAL_ID AS TGT_DEAL_ID,\nSRC.DEAL_ID AS SRC_DEAL_ID,\nTGT.LEAD_CONTRACT_ID AS TGT_CONTRACT_ID,\nSRC.CONTRACT_ID AS SRC_CONTRACT_ID,\nSRC.FINAL_LEAD_SCORE_TIER AS SRC_LEAD_STAGE,\nTGT.LEAD_SCORE AS TGT_LEAD_SCORE,\nSRC.DEAL_STAGE AS SRC_DEAL_STAGE,\nTGT.LEAD_STAGE AS TGT_LEAD_STAGE,\nCASE WHEN SRC_LEAD_ID = TGT_LEAD_ID AND TGT_DEAL_ID IS NULL THEN 'UDND'\nWHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID IS NOT NULL AND SRC_CONTRACT_ID IS NULL AND  TGT_DEAL_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'UD' --\n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'UD'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID!=TGT_DEAL_ID AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n       \n       WHEN SRC_LEAD_ID IS NOT NULL AND SRC_DEAL_ID IS NOT NULL AND TGT_LEAD_ID IS NULL AND TGT_DEAL_ID IS NULL AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID =TGT_DEAL_ID AND SRC_CONTRACT_ID IS NOT NULL AND TGT_CONTRACT_ID IS NULL THEN 'UC'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID = TGT_CONTRACT_ID THEN 'UC'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID != TGT_CONTRACT_ID THEN 'I'\n       \n       WHEN SRC_LEAD_ID IS NOT NULL AND SRC_DEAL_ID IS NOT NULL AND SRC_CONTRACT_ID IS NOT NULL AND TGT_LEAD_ID IS NULL AND TGT_DEAL_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n        --  Added May 20 2020\n       \n       ELSE 'NA'\nEND STATUS,\nSRC.CONTACT_EMAIL AS SRC_CONTACT_EMAIL,\nSRC.CUSTOMER_FIRST_NAME AS SRC_CUSTOMER_FIRST_NAME,\nSRC.CUSTOMER_LAST_NAME AS SRC_CUSTOMER_LAST_NAME,\nSRC.CONTACT_NAME AS SRC_CONTACT_NAME,\nSRC.FINAL_LEAD_SCORE_TIER AS SRC_FINAL_LEAD_SCORE_TIER,\nSRC.DEAL_PIPELINE AS SRC_DEAL_PIPELINE,\nSRC.PREFERRED_FOREST AS SRC_PREFERRED_FOREST,\nSRC.REGIONAL_DEPOSIT_FOREST AS SRC_REGIONAL_DEPOSIT_FOREST,\nSRC.DEAL_FOREST AS SRC_DEAL_FOREST,\nSRC.TOUR_SCHEDULED_FOREST AS SRC_TOUR_SCHEDULED_FOREST,\nSRC.CONTRACT_FOREST AS SRC_CONTRACT_FOREST,\nSRC.CONTRACT_VALUE AS SRC_CONTRACT_VALUE,\nSRC.CONTRACT_CHANNEL AS SRC_CONTRACT_CHANNEL,\nSRC.ARBOR_TAG_ID AS SRC_ARBOR_TAG_ID,\n--SRC.DEAL_STAGE AS SRC_DEAL_STAGE,\nSRC.DEAL_CREATED_DT AS SRC_DEAL_CREATED_DT,\nSRC.CONTRACT_STATUS AS SRC_CONTRACT_STATUS,\nSRC.CONTRACT_REASON AS SRC_CONTRACT_REASON,\nSRC.DEAL_CLOSED_TIMESTAMP AS SRC_DEAL_CLOSED_TIMESTAMP,\nSRC.SALES_REP_NAME AS SRC_SALES_REP_NAME,\nSRC.SALES_REP_EMAIL AS SRC_SALES_REP_EMAIL,\nSRC.SDR_NAME AS SRC_SDR_NAME,\nSRC.SALES_REP_ID AS SRC_SALES_REP_ID,\nSRC.PROJECTED_DEAL_AMOUNT AS SRC_PROJECTED_DEAL_AMOUNT,\nSRC.TOUR_SCHEDULED_CHANNEL AS SRC_TOUR_SCHEDULED_CHANNEL,\nSRC.DEPOSIT_TYPE AS SRC_DEPOSIT_TYPE,\nSRC.PITCH_SCHEDULE_TYPE AS SRC_PITCH_SCHEDULE_TYPE,\nSRC.TOUR_HELD_FOREST AS SRC_TOUR_HELD_FOREST,\nSRC.TREE_ID AS SRC_TREE_ID,\nSRC.TOUR_HELD_FOREST_STEWARD AS SRC_TOUR_HELD_FOREST_STEWARD,\nSRC.TOUR_HELD_CHANNEL AS SRC_TOUR_HELD_CHANNEL,\nSRC.CONTACT_CREATED_DT AS SRC_CONTACT_CREATED_DT,\n--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ADDED ON MAY.20 2020\n\t'9999-01-01' AS MAX_DT,\n\t'9999-12-31 13:30:00' AS COMP_DT,\t\n\tIFNULL(SRC.SALES_LEAD_MQL_TIMESTAMP,TO_TIMESTAMP_NTZ(MAX_DT)) SALES_LEAD_MQL_TIMESTAMP1,\n\tIFNULL(SRC.PITCH_SCHEDULED_DT,TO_TIMESTAMP_NTZ(MAX_DT)) PITCH_SCHEDULED1,\n\tIFNULL(SRC.PITCH_HELD_DT,TO_TIMESTAMP_NTZ(MAX_DT)) PITCH_HELD1,\n\tIFNULL(SRC.TOUR_SCHEDULED_DT,TO_TIMESTAMP_NTZ(MAX_DT))TOUR_SCHEDULED1,\n\tIFNULL(SRC.TOUR_HELD_DT,TO_TIMESTAMP_NTZ(MAX_DT)) TOUR_HELD1 ,\n\tIFNULL(SRC.CONTRACT_SIGNED_DT,TO_TIMESTAMP_NTZ(MAX_DT)) CONTRACT_SIGNED1,\n--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ \t   \n   \t\t  \n    --SRC.SALES_LEAD_MQL_TIMESTAMP AS SRC_SALES_LEAD_MQL_TIMESTAMP,\n\tLEAST(SALES_LEAD_MQL_TIMESTAMP1,PITCH_SCHEDULED1, PITCH_HELD1,TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_SALES_LEAD_MQL_TIMESTAMP,\n\t\n\t--SRC.PITCH_SCHEDULED_DT AS SRC_PITCH_SCHEDULED_DT,\n\tLEAST(PITCH_SCHEDULED1, PITCH_HELD1, TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_PITCH_SCHEDULED_DT,\n\t\n\tSRC.SQL_TIMESTAMP AS SRC_SQL_TIMESTAMP,\n\t\n\t--SRC.PITCH_HELD_DT AS SRC_PITCH_HELD_DT,\n    LEAST(PITCH_HELD1,TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_PITCH_HELD_DT,\n    \t\n\tSRC.DEPOSIT_TIMESTAMP AS SRC_DEPOSIT_TIMESTAMP,\n\t\n\t--SRC.TOUR_SCHEDULED_DT AS SRC_TOUR_SCHEDULED_DT,\n\tLEAST(TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1)AS  SRC_TOUR_SCHEDULED_DT,\n\t\n\t--SRC.TOUR_HELD_DT AS SRC_TOUR_HELD_DT,\n\tLEAST(TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_TOUR_HELD_DT,\n\t\n\tSRC.CONTRACT_SIGNED_DT AS SRC_CONTRACT_SIGNED_DT,\n\t\n\tSRC.INSERT_DATE AS SRC_INSERT_DATE,\n\tSRC.UPDATE_DATE AS SRC_UPDATE_DATE\n--###############################################\n--SRC.SALES_LEAD_MQL_TIMESTAMP AS SRC_SALES_LEAD_MQL_TIMESTAMP,\n--SRC.PITCH_SCHEDULED_DT AS SRC_PITCH_SCHEDULED_DT,\n--SRC.SQL_TIMESTAMP AS SRC_SQL_TIMESTAMP,\n--SRC.PITCH_HELD_DT AS SRC_PITCH_HELD_DT,\n--SRC.DEPOSIT_TIMESTAMP AS SRC_DEPOSIT_TIMESTAMP,\n--SRC.TOUR_SCHEDULED_DT AS SRC_TOUR_SCHEDULED_DT,\n--SRC.TOUR_HELD_DT AS SRC_TOUR_HELD_DT,\n--SRC.CONTRACT_SIGNED_DT AS SRC_CONTRACT_SIGNED_DT,\n--SRC.INSERT_DATE AS SRC_INSERT_DATE,\n--SRC.UPDATE_DATE AS SRC_UPDATE_DATE\nFROM BPF_ODS.\"PUBLIC\".VW_SRC_ODS_LEAD SRC\nINNER JOIN \"BPF_DATAMART\".\"PUBLIC\".\"FACT_LEAD\" TGT \nON (SRC.CUSTOMER_ID = TGT.LEAD_ID) AND SRC.DEAL_ID IS NOT NULL AND TGT.LEAD_DEAL_ID IS NULL AND TGT.LEAD_CONTRACT_ID IS NULL\nUNION ALL\n---\nSELECT \nTGT.LEAD_KEY AS TGT_LEAD_KEY,\nTGT.LEAD_ID AS TGT_LEAD_ID,\nSRC.CUSTOMER_ID AS SRC_LEAD_ID,\nTGT.LEAD_DEAL_ID AS TGT_DEAL_ID,\nSRC.DEAL_ID AS SRC_DEAL_ID,\nTGT.LEAD_CONTRACT_ID AS TGT_CONTRACT_ID,\nSRC.CONTRACT_ID AS SRC_CONTRACT_ID,\nSRC.FINAL_LEAD_SCORE_TIER AS SRC_LEAD_STAGE,\nTGT.LEAD_SCORE AS TGT_LEAD_SCORE,\nSRC.DEAL_STAGE AS SRC_DEAL_STAGE,\nTGT.LEAD_STAGE AS TGT_LEAD_STAGE,\nCASE WHEN SRC_LEAD_ID = TGT_LEAD_ID AND TGT_DEAL_ID IS NULL THEN 'UDND'\nWHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID IS NOT NULL AND SRC_CONTRACT_ID IS NULL AND  TGT_DEAL_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'UD' --\n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'UD'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID!=TGT_DEAL_ID AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n       \n       WHEN SRC_LEAD_ID IS NOT NULL AND SRC_DEAL_ID IS NOT NULL AND TGT_LEAD_ID IS NULL AND TGT_DEAL_ID IS NULL AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID =TGT_DEAL_ID AND SRC_CONTRACT_ID IS NOT NULL AND TGT_CONTRACT_ID IS NULL THEN 'UC'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID = TGT_CONTRACT_ID THEN 'UC'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID != TGT_CONTRACT_ID THEN 'I'\n       \n       WHEN SRC_LEAD_ID IS NOT NULL AND SRC_DEAL_ID IS NOT NULL AND SRC_CONTRACT_ID IS NOT NULL AND TGT_LEAD_ID IS NULL AND TGT_DEAL_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n        --  Added May 20 2020\n       \n       ELSE 'NA'\nEND STATUS,\nSRC.CONTACT_EMAIL AS SRC_CONTACT_EMAIL,\nSRC.CUSTOMER_FIRST_NAME AS SRC_CUSTOMER_FIRST_NAME,\nSRC.CUSTOMER_LAST_NAME AS SRC_CUSTOMER_LAST_NAME,\nSRC.CONTACT_NAME AS SRC_CONTACT_NAME,\nSRC.FINAL_LEAD_SCORE_TIER AS SRC_FINAL_LEAD_SCORE_TIER,\nSRC.DEAL_PIPELINE AS SRC_DEAL_PIPELINE,\nSRC.PREFERRED_FOREST AS SRC_PREFERRED_FOREST,\nSRC.REGIONAL_DEPOSIT_FOREST AS SRC_REGIONAL_DEPOSIT_FOREST,\nSRC.DEAL_FOREST AS SRC_DEAL_FOREST,\nSRC.TOUR_SCHEDULED_FOREST AS SRC_TOUR_SCHEDULED_FOREST,\nSRC.CONTRACT_FOREST AS SRC_CONTRACT_FOREST,\nSRC.CONTRACT_VALUE AS SRC_CONTRACT_VALUE,\nSRC.CONTRACT_CHANNEL AS SRC_CONTRACT_CHANNEL,\nSRC.ARBOR_TAG_ID AS SRC_ARBOR_TAG_ID,\n--SRC.DEAL_STAGE AS SRC_DEAL_STAGE,\nSRC.DEAL_CREATED_DT AS SRC_DEAL_CREATED_DT,\nSRC.CONTRACT_STATUS AS SRC_CONTRACT_STATUS,\nSRC.CONTRACT_REASON AS SRC_CONTRACT_REASON,\nSRC.DEAL_CLOSED_TIMESTAMP AS SRC_DEAL_CLOSED_TIMESTAMP,\nSRC.SALES_REP_NAME AS SRC_SALES_REP_NAME,\nSRC.SALES_REP_EMAIL AS SRC_SALES_REP_EMAIL,\nSRC.SDR_NAME AS SRC_SDR_NAME,\nSRC.SALES_REP_ID AS SRC_SALES_REP_ID,\nSRC.PROJECTED_DEAL_AMOUNT AS SRC_PROJECTED_DEAL_AMOUNT,\nSRC.TOUR_SCHEDULED_CHANNEL AS SRC_TOUR_SCHEDULED_CHANNEL,\nSRC.DEPOSIT_TYPE AS SRC_DEPOSIT_TYPE,\nSRC.PITCH_SCHEDULE_TYPE AS SRC_PITCH_SCHEDULE_TYPE,\nSRC.TOUR_HELD_FOREST AS SRC_TOUR_HELD_FOREST,\nSRC.TREE_ID AS SRC_TREE_ID,\nSRC.TOUR_HELD_FOREST_STEWARD AS SRC_TOUR_HELD_FOREST_STEWARD,\nSRC.TOUR_HELD_CHANNEL AS SRC_TOUR_HELD_CHANNEL,\nSRC.CONTACT_CREATED_DT AS SRC_CONTACT_CREATED_DT,\n--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ADDED ON MAY.20 2020\n\t'9999-01-01' AS MAX_DT,\n\t'9999-12-31 13:30:00' AS COMP_DT,\t\n\tIFNULL(SRC.SALES_LEAD_MQL_TIMESTAMP,TO_TIMESTAMP_NTZ(MAX_DT)) SALES_LEAD_MQL_TIMESTAMP1,\n\tIFNULL(SRC.PITCH_SCHEDULED_DT,TO_TIMESTAMP_NTZ(MAX_DT)) PITCH_SCHEDULED1,\n\tIFNULL(SRC.PITCH_HELD_DT,TO_TIMESTAMP_NTZ(MAX_DT)) PITCH_HELD1,\n\tIFNULL(SRC.TOUR_SCHEDULED_DT,TO_TIMESTAMP_NTZ(MAX_DT))TOUR_SCHEDULED1,\n\tIFNULL(SRC.TOUR_HELD_DT,TO_TIMESTAMP_NTZ(MAX_DT)) TOUR_HELD1 ,\n\tIFNULL(SRC.CONTRACT_SIGNED_DT,TO_TIMESTAMP_NTZ(MAX_DT)) CONTRACT_SIGNED1,\n--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ \t   \n   \t\t  \n    --SRC.SALES_LEAD_MQL_TIMESTAMP AS SRC_SALES_LEAD_MQL_TIMESTAMP,\n\tLEAST(SALES_LEAD_MQL_TIMESTAMP1,PITCH_SCHEDULED1, PITCH_HELD1,TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_SALES_LEAD_MQL_TIMESTAMP,\n\t\n\t--SRC.PITCH_SCHEDULED_DT AS SRC_PITCH_SCHEDULED_DT,\n\tLEAST(PITCH_SCHEDULED1, PITCH_HELD1, TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_PITCH_SCHEDULED_DT,\n\t\n\tSRC.SQL_TIMESTAMP AS SRC_SQL_TIMESTAMP,\n\t\n\t--SRC.PITCH_HELD_DT AS SRC_PITCH_HELD_DT,\n    LEAST(PITCH_HELD1,TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_PITCH_HELD_DT,\n    \t\n\tSRC.DEPOSIT_TIMESTAMP AS SRC_DEPOSIT_TIMESTAMP,\n\t\n\t--SRC.TOUR_SCHEDULED_DT AS SRC_TOUR_SCHEDULED_DT,\n\tLEAST(TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1)AS  SRC_TOUR_SCHEDULED_DT,\n\t\n\t--SRC.TOUR_HELD_DT AS SRC_TOUR_HELD_DT,\n\tLEAST(TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_TOUR_HELD_DT,\n\t\n\tSRC.CONTRACT_SIGNED_DT AS SRC_CONTRACT_SIGNED_DT,\n\t\t\n\tSRC.INSERT_DATE AS SRC_INSERT_DATE,\n\tSRC.UPDATE_DATE AS SRC_UPDATE_DATE\n--###############################################\n--SRC.SALES_LEAD_MQL_TIMESTAMP AS SRC_SALES_LEAD_MQL_TIMESTAMP,\n--SRC.PITCH_SCHEDULED_DT AS SRC_PITCH_SCHEDULED_DT,\n--SRC.SQL_TIMESTAMP AS SRC_SQL_TIMESTAMP,\n--SRC.PITCH_HELD_DT AS SRC_PITCH_HELD_DT,\n--SRC.DEPOSIT_TIMESTAMP AS SRC_DEPOSIT_TIMESTAMP,\n--SRC.TOUR_SCHEDULED_DT AS SRC_TOUR_SCHEDULED_DT,\n--SRC.TOUR_HELD_DT AS SRC_TOUR_HELD_DT,\n--SRC.CONTRACT_SIGNED_DT AS SRC_CONTRACT_SIGNED_DT,\n--SRC.INSERT_DATE AS SRC_INSERT_DATE,\n--SRC.UPDATE_DATE AS SRC_UPDATE_DATE\n--FROM \"BPF_ODS\".\"PUBLIC\".\"VW_TEST_ODS_LEAD\" SRC\nFROM BPF_ODS.\"PUBLIC\".VW_SRC_ODS_LEAD SRC\nINNER JOIN \"BPF_DATAMART\".\"PUBLIC\".\"FACT_LEAD\" TGT \nON (SRC.CUSTOMER_ID = TGT.LEAD_ID) AND (SRC.DEAL_ID  = TGT.LEAD_DEAL_ID) AND TGT.LEAD_CONTRACT_ID IS NULL\nUNION ALL\n---\nSELECT \nNULL AS TGT_LEAD_KEY,\nNULL AS TGT_LEAD_ID,\nSRC.CUSTOMER_ID AS SRC_LEAD_ID,\nNULL AS TGT_DEAL_ID,\nSRC.DEAL_ID AS SRC_DEAL_ID,\nNULL AS TGT_CONTRACT_ID,\nSRC.CONTRACT_ID AS SRC_CONTRACT_ID,\nSRC.FINAL_LEAD_SCORE_TIER AS SRC_LEAD_STAGE,\nNULL AS TGT_LEAD_SCORE,\nDEAL_STAGE AS TGT_DEAL_STAGE,\nSRC.DEAL_STAGE AS SRC_DEAL_STAGE,\nCASE WHEN SRC_LEAD_ID = TGT_LEAD_ID AND TGT_DEAL_ID IS NULL THEN 'UDND'\nWHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID IS NOT NULL AND SRC_CONTRACT_ID IS NULL AND  TGT_DEAL_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'UD' --\n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'UD'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID!=TGT_DEAL_ID AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n       \n       WHEN SRC_LEAD_ID IS NOT NULL AND SRC_DEAL_ID IS NOT NULL AND TGT_LEAD_ID IS NULL AND TGT_DEAL_ID IS NULL AND SRC_CONTRACT_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID =TGT_DEAL_ID AND SRC_CONTRACT_ID IS NOT NULL AND TGT_CONTRACT_ID IS NULL THEN 'UC'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID = TGT_CONTRACT_ID THEN 'UC'\n       \n       WHEN SRC_LEAD_ID = TGT_LEAD_ID AND SRC_DEAL_ID=TGT_DEAL_ID AND SRC_CONTRACT_ID != TGT_CONTRACT_ID THEN 'I'\n       \n       WHEN SRC_LEAD_ID IS NOT NULL AND SRC_DEAL_ID IS NOT NULL AND SRC_CONTRACT_ID IS NOT NULL AND TGT_LEAD_ID IS NULL AND TGT_DEAL_ID IS NULL AND TGT_CONTRACT_ID IS NULL THEN 'I'\n       --  Added May 20 2020\n       \n       ELSE 'NA'\nEND STATUS,\nSRC.CONTACT_EMAIL AS SRC_CONTACT_EMAIL,\nSRC.CUSTOMER_FIRST_NAME AS SRC_CUSTOMER_FIRST_NAME,\nSRC.CUSTOMER_LAST_NAME AS SRC_CUSTOMER_LAST_NAME,\nSRC.CONTACT_NAME AS SRC_CONTACT_NAME,\nSRC.FINAL_LEAD_SCORE_TIER AS SRC_FINAL_LEAD_SCORE_TIER,\nSRC.DEAL_PIPELINE AS SRC_DEAL_PIPELINE,\nSRC.PREFERRED_FOREST AS SRC_PREFERRED_FOREST,\nSRC.REGIONAL_DEPOSIT_FOREST AS SRC_REGIONAL_DEPOSIT_FOREST,\nSRC.DEAL_FOREST AS SRC_DEAL_FOREST,\nSRC.TOUR_SCHEDULED_FOREST AS SRC_TOUR_SCHEDULED_FOREST,\nSRC.CONTRACT_FOREST AS SRC_CONTRACT_FOREST,\nSRC.CONTRACT_VALUE AS SRC_CONTRACT_VALUE,\nSRC.CONTRACT_CHANNEL AS SRC_CONTRACT_CHANNEL,\nSRC.ARBOR_TAG_ID AS SRC_ARBOR_TAG_ID,\n--SRC.DEAL_STAGE AS SRC_DEAL_STAGE,\nSRC.DEAL_CREATED_DT AS SRC_DEAL_CREATED_DT,\nSRC.CONTRACT_STATUS AS SRC_CONTRACT_STATUS,\nSRC.CONTRACT_REASON AS SRC_CONTRACT_REASON,\nSRC.DEAL_CLOSED_TIMESTAMP AS SRC_DEAL_CLOSED_TIMESTAMP,\nSRC.SALES_REP_NAME AS SRC_SALES_REP_NAME,\nSRC.SALES_REP_EMAIL AS SRC_SALES_REP_EMAIL,\nSRC.SDR_NAME AS SRC_SDR_NAME,\nSRC.SALES_REP_ID AS SRC_SALES_REP_ID,\nSRC.PROJECTED_DEAL_AMOUNT AS SRC_PROJECTED_DEAL_AMOUNT,\nSRC.TOUR_SCHEDULED_CHANNEL AS SRC_TOUR_SCHEDULED_CHANNEL,\nSRC.DEPOSIT_TYPE AS SRC_DEPOSIT_TYPE,\nSRC.PITCH_SCHEDULE_TYPE AS SRC_PITCH_SCHEDULE_TYPE,\nSRC.TOUR_HELD_FOREST AS SRC_TOUR_HELD_FOREST,\nSRC.TREE_ID AS SRC_TREE_ID,\nSRC.TOUR_HELD_FOREST_STEWARD AS SRC_TOUR_HELD_FOREST_STEWARD,\nSRC.TOUR_HELD_CHANNEL AS SRC_TOUR_HELD_CHANNEL,\nSRC.CONTACT_CREATED_DT AS SRC_CONTACT_CREATED_DT,\n--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ ADDED ON MAY.20 2020\n\t'9999-01-01' AS MAX_DT,\n\t'9999-12-31 13:30:00' AS COMP_DT,\t\n\tIFNULL(SRC.SALES_LEAD_MQL_TIMESTAMP,TO_TIMESTAMP_NTZ(MAX_DT)) SALES_LEAD_MQL_TIMESTAMP1,\n\tIFNULL(SRC.PITCH_SCHEDULED_DT,TO_TIMESTAMP_NTZ(MAX_DT)) PITCH_SCHEDULED1,\n\tIFNULL(SRC.PITCH_HELD_DT,TO_TIMESTAMP_NTZ(MAX_DT)) PITCH_HELD1,\n\tIFNULL(SRC.TOUR_SCHEDULED_DT,TO_TIMESTAMP_NTZ(MAX_DT))TOUR_SCHEDULED1,\n\tIFNULL(SRC.TOUR_HELD_DT,TO_TIMESTAMP_NTZ(MAX_DT)) TOUR_HELD1 ,\n\tIFNULL(SRC.CONTRACT_SIGNED_DT,TO_TIMESTAMP_NTZ(MAX_DT)) CONTRACT_SIGNED1,\n--@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@ \t   \n   \t\t  \n    --SRC.SALES_LEAD_MQL_TIMESTAMP AS SRC_SALES_LEAD_MQL_TIMESTAMP,\n\tLEAST(SALES_LEAD_MQL_TIMESTAMP1,PITCH_SCHEDULED1, PITCH_HELD1,TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_SALES_LEAD_MQL_TIMESTAMP,\n\t\n\t--SRC.PITCH_SCHEDULED_DT AS SRC_PITCH_SCHEDULED_DT,\n\tLEAST(PITCH_SCHEDULED1, PITCH_HELD1, TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_PITCH_SCHEDULED_DT,\n\t\n\tSRC.SQL_TIMESTAMP AS SRC_SQL_TIMESTAMP,\n\t\n\t--SRC.PITCH_HELD_DT AS SRC_PITCH_HELD_DT,\n    LEAST(PITCH_HELD1,TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_PITCH_HELD_DT,\n    \t\n\tSRC.DEPOSIT_TIMESTAMP AS SRC_DEPOSIT_TIMESTAMP,\n\t\n\t--SRC.TOUR_SCHEDULED_DT AS SRC_TOUR_SCHEDULED_DT,\n\tLEAST(TOUR_SCHEDULED1, TOUR_HELD1, CONTRACT_SIGNED1)AS  SRC_TOUR_SCHEDULED_DT,\n\t\n\t--SRC.TOUR_HELD_DT AS SRC_TOUR_HELD_DT,\n\tLEAST(TOUR_HELD1, CONTRACT_SIGNED1) AS SRC_TOUR_HELD_DT,\n\t\n\tSRC.CONTRACT_SIGNED_DT AS SRC_CONTRACT_SIGNED_DT,\n\t\n\tSRC.INSERT_DATE AS SRC_INSERT_DATE,\n\tSRC.UPDATE_DATE AS SRC_UPDATE_DATE\n--###############################################\n--SRC.SALES_LEAD_MQL_TIMESTAMP AS SRC_SALES_LEAD_MQL_TIMESTAMP,\n--SRC.PITCH_SCHEDULED_DT AS SRC_PITCH_SCHEDULED_DT,\n--SRC.SQL_TIMESTAMP AS SRC_SQL_TIMESTAMP,\n--SRC.PITCH_HELD_DT AS SRC_PITCH_HELD_DT,\n--SRC.DEPOSIT_TIMESTAMP AS SRC_DEPOSIT_TIMESTAMP,\n--SRC.TOUR_SCHEDULED_DT AS SRC_TOUR_SCHEDULED_DT,\n--SRC.TOUR_HELD_DT AS SRC_TOUR_HELD_DT,\n--SRC.CONTRACT_SIGNED_DT AS SRC_CONTRACT_SIGNED_DT,\n--SRC.INSERT_DATE AS SRC_INSERT_DATE,\n--SRC.UPDATE_DATE AS SRC_UPDATE_DATE\n\nFROM BPF_ODS.\"PUBLIC\".VW_SRC_ODS_LEAD SRC\nWHERE SRC.CUSTOMER_ID NOT IN (SELECT TGT.LEAD_ID FROM \"BPF_DATAMART\".\"PUBLIC\".\"FACT_LEAD\" TGT) \n) ODS_LEAD\nLEFT OUTER JOIN\nBPF_DATAMART.\"PUBLIC\".DIM_CUSTOMER  C\nON CAST(SRC_LEAD_ID AS VARCHAR) = CAST(C.CUST_ID AS VARCHAR)\nLEFT OUTER JOIN \nBPF_DATAMART.\"PUBLIC\".DIM_SALES_PERSON S\nON CAST(SRC_SALES_REP_ID AS VARCHAR) = CAST(S.SALES_PERSON_ID AS VARCHAR)\nLEFT OUTER JOIN \nBPF_DATAMART.\"PUBLIC\".DIM_FOREST F\nON CAST(SRC_DEAL_FOREST AS VARCHAR(500)) = CAST(F.FOREST_FULLNAME AS VARCHAR(500))\nLEFT OUTER JOIN BPF_DATAMART.\"PUBLIC\".DIM_TREE_PRODUCT T\nON CAST(SRC_TREE_ID AS VARCHAR) =CAST(T.TREE_ID AS VARCHAR)\nWHERE SRC_LEAD_ID='67096651'\nORDER BY ROW_NBR\n  )QRY"}}}},"visible":true},"3":{"slot":3,"name":"Scalar Variable Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"RowNbrMax"},"2":{"slot":2,"type":"STRING","value":"MAX_DEAL_NBR"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"RowNbrMin"},"2":{"slot":2,"type":"STRING","value":"MIN_DEAL_NBR"}}}},"visible":true},"4":{"slot":4,"name":"","elements":{},"visible":false}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[]},"44860":{"id":44860,"inputCardinality":"ONE","outputCardinality":"MANY","connectorHint":"SUCCESS_FAIL","executionHint":"TRANSFORM","implementationID":1896325668,"x":-432,"y":-240,"width":32,"height":32,"inputConnectorIDs":[],"outputSuccessConnectorIDs":[],"outputFailureConnectorIDs":[],"outputUnconditionalConnectorIDs":[],"outputTrueConnectorIDs":[],"outputFalseConnectorIDs":[],"exportMappings":{},"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BPF_CUSTFNL_FACT_LEAD_LOAD"}}}},"visible":true},"2":{"slot":2,"name":"Transformation Job","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"BPF_CUSTFNL_FACT_LEAD_INCR_LOAD"}}}},"visible":true},"3":{"slot":3,"name":"","elements":{},"visible":false},"4":{"slot":4,"name":"Set Scalar Variables","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"TJ_ROWNBR"},"2":{"slot":2,"type":"STRING","value":"${Iterate_Value}"}}}},"visible":true},"5":{"slot":5,"name":"Set Grid Variables","elements":{},"visible":true}},"expectedFailure":null,"activationStatus":"ENABLED","outputIterationConnectorIDs":[],"inputIterationConnectorIDs":[44863]}},"successConnectors":{"44829":{"id":44829,"sourceID":44827,"targetID":44826}},"failureConnectors":{},"unconditionalConnectors":{"44830":{"id":44830,"sourceID":44825,"targetID":44827}},"trueConnectors":{},"falseConnectors":{},"iterationConnectors":{"44863":{"id":44863,"sourceID":44826,"targetID":44860}},"noteConnectors":{},"notes":{},"variables":{"JV_Current_AccountId":{"definition":{"name":"JV_Current_AccountId","type":"TEXT","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"123456"},"RowNbrMax":{"definition":{"name":"RowNbrMax","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"1"},"RowNbrMin":{"definition":{"name":"RowNbrMin","type":"DECIMAL","scope":"TASKBATCH","description":"","visibility":"PUBLIC"},"value":"1"}},"grids":{}},"info":{"name":"OJ_LOOP_FACT_LEAD","description":"","type":"ORCHESTRATION","tag":"3a9c5e42-9bc2-4db3-b089-126d5b9c5107"}}